{"version":3,"sources":["utils.js","components/VideoCamera/VideoCamera.js","components/VideoCamera/useUserMedia.js","App.js","reportWebVitals.js","index.js"],"names":["drawEmoticon","ctx","x","y","scale","emoticon","beginPath","arc","Math","PI","fillText","drawEmoticons","pose","video","videoWidth","videoHeight","canvas","emoticons","current","getContext","filteredResult","getFilteredBodyparts","keypoints","width","height","minConfidence","font","textAlign","i","length","keypoint","score","position","drawTextPoints","bodyparts","reduce","filtered","option","Object","keys","includes","part","push","VideoCamera","videoRef","constraints","useState","stream","setStream","error","setError","status","setStatus","useEffect","canceled","navigator","mediaDevices","getUserMedia","then","useUserMedia","srcObject","setAttribute","play","message","ref","defaultProps","INPUT_RESOLUTION","EMOTICONS","nose","leftEye","rightEye","leftEar","rightEar","App","facingMode","setFacingMode","webcamEl","useRef","canvasEl","handleCameraClick","useCallback","clearRect","detectPose","posenet_model","a","readyState","camera","estimateSinglePose","posenet","inputResolution","model","setInterval","initPoseNet","className","onClick","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.ca4af295.chunk.js","sourcesContent":["/**\n * Draw pose keypoints onto a canvas\n */\nexport function drawTextPoints(keypoints, minConfidence, ctx, scale = 1) {\n  ctx.font = \"16px Arial\";\n  ctx.textAlign = \"center\";\n\n  for (let i = 0; i < keypoints.length; i++) {\n    const keypoint = keypoints[i];\n\n    if (keypoint.score < minConfidence) {\n      continue;\n    }\n\n    const { y, x } = keypoint.position;\n\n    drawEmoticon(ctx, x, y, scale, keypoint.emoticon);\n  }\n}\n\n/**\n * Draws the text/emoticon on the keypoints\n */\nfunction drawEmoticon(ctx, x, y, scale, emoticon) {\n  ctx.beginPath();\n  ctx.arc(x * scale, y * scale, 3, 0, 2 * Math.PI);\n  ctx.fillText(emoticon, x, y);\n}\n\n/**\n * Draws emoticons on the canvas\n */\nexport function drawEmoticons(\n  pose,\n  video,\n  videoWidth,\n  videoHeight,\n  canvas,\n  emoticons\n) {\n  const ctx = canvas.current.getContext(\"2d\");\n  const filteredResult = getFilteredBodyparts(pose.keypoints, emoticons);\n\n  canvas.current.width = videoWidth;\n  canvas.current.height = videoHeight;\n\n  drawTextPoints(filteredResult, 0.9, ctx, 1);\n}\n\n/**\n * Clears the canvas\n */\nexport function clearCanvas(canvas) {\n  const ctx = canvas.getContext(\"2d\");\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n}\n\n/**\n * Returns merged and filtered array of keypoints/bodyparts\n */\nexport const getFilteredBodyparts = (keypoints, bodyparts) =>\n  keypoints.reduce((filtered, option) => {\n    if (Object.keys(bodyparts).includes(option.part)) {\n      filtered.push({\n        ...option,\n        emoticon: bodyparts[option.part],\n      });\n    }\n    return filtered;\n  }, []);\n","import { useEffect } from \"react\";\nimport PropTypes from \"prop-types\";\nimport useUserMedia from \"./useUserMedia\";\n\nfunction VideoCamera({ videoRef, constraints }) {\n  const { error, status, stream } = useUserMedia(constraints);\n\n  useEffect(() => {\n    if (status !== \"resolved\" || !stream) {\n      return;\n    }\n\n    const video = videoRef.current;\n    video.srcObject = stream;\n\n    // Required for IOS\n    video.setAttribute(\"playsinline\", true);\n    video.setAttribute(\"autoplay\", true);\n\n    video.play();\n  }, [stream]);\n\n  if (status === \"pending\") {\n    return <p>{\"Loading...\"}</p>;\n  }\n\n  if (status === \"error\") {\n    return <p>{error.message}</p>;\n  }\n\n  return <video ref={videoRef} />;\n}\n\nVideoCamera.defaultProps = {\n  constraints: null,\n};\n\nVideoCamera.propTypes = {\n  /** Media constraints object */\n  constraints: PropTypes.shape({}),\n  /** Ref to the video element */\n  videoRef: PropTypes.oneOfType([\n    PropTypes.func,\n    PropTypes.shape({ current: PropTypes.instanceOf(Element) }),\n  ]),\n};\n\nexport default VideoCamera;\n","import { useEffect, useState } from \"react\";\n\nexport default function useUserMedia(constraints) {\n  const [stream, setStream] = useState();\n  const [error, setError] = useState();\n  const [status, setStatus] = useState(\"pending\");\n\n  useEffect(() => {\n    let canceled = false;\n    setStatus(\"pending\");\n    navigator.mediaDevices.getUserMedia(constraints).then(\n      (stream) => {\n        if (!canceled) {\n          setStatus(\"resolved\");\n          setStream(stream);\n        }\n      },\n      (error) => {\n        if (!canceled) {\n          setStatus(\"error\");\n          setError(error);\n        }\n      }\n    );\n\n    return () => {\n      canceled = true;\n    };\n  }, [constraints]);\n\n  return { error, status, stream };\n}\n","import { useRef, useState, useCallback } from \"react\";\nimport * as tf from \"@tensorflow/tfjs\";\nimport * as posenet from \"@tensorflow-models/posenet\";\nimport { clearCanvas, drawEmoticons } from \"./utils\";\n\nimport \"./App.css\";\nimport VideoCamera from \"./components/VideoCamera/VideoCamera\";\n\n// TODOS\n// - Only show button if there are multiple cameras\n// - Make emoticon settings adjstable by the user\n// - Allow multiple input resolutions\n\n// App consts\nconst REFRESH_RATE = 100;\nconst INPUT_RESOLUTION = { width: 640, height: 480 };\nconst SCALE = 1;\nconst EMOTICONS = {\n  nose: \"❌\",\n  leftEye: \"🌀\",\n  rightEye: \"🌀\",\n  leftEar: \"⚠️\",\n  rightEar: \"⚠️\",\n};\n\nfunction App() {\n  const [facingMode, setFacingMode] = useState(\"user\");\n  const webcamEl = useRef(null);\n  const canvasEl = useRef(null);\n\n  const handleCameraClick = useCallback(() => {\n    // Clear emoticons from canvas\n    clearCanvas(canvasEl.current);\n    // Set facing mode to environment or user\n    setFacingMode(facingMode === \"environment\" ? \"user\" : \"environment\");\n  }, [facingMode]);\n\n  const detectPose = async (posenet_model) => {\n    if (webcamEl.current !== null && webcamEl.current.readyState === 4) {\n      const camera = webcamEl.current;\n      const videoWidth = webcamEl.current.videoWidth;\n      const videoHeight = webcamEl.current.videoHeight;\n\n      webcamEl.current.width = videoWidth;\n      webcamEl.current.height = videoHeight;\n\n      // Get pose and detect body parts using the posenet model\n      const posenet = await posenet_model.estimateSinglePose(camera);\n      drawEmoticons(\n        posenet,\n        camera,\n        videoWidth,\n        videoHeight,\n        canvasEl,\n        EMOTICONS\n      );\n    }\n  };\n\n  const initPoseNet = async () => {\n    const model = await posenet.load({\n      inputResolution: INPUT_RESOLUTION,\n      scale: SCALE,\n    });\n\n    setInterval(() => {\n      detectPose(model);\n    }, REFRESH_RATE);\n  };\n\n  initPoseNet();\n\n  return (\n    <div className=\"App\">\n      <VideoCamera\n        videoRef={webcamEl}\n        constraints={{\n          video: {\n            facingMode,\n          },\n        }}\n      />\n      <canvas ref={canvasEl} />\n      <button onClick={handleCameraClick}>Flip cameras</button>\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}